<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Military Roster Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>body{margin:0;padding:0;}</style>
</head>
<body>
    <div id="app"></div>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
        const {useState,useEffect}=React;
        const RANKS=['PVT','PFC','LCPL','CPL','SGT','SSGT','GYSGT','MSGT','MGYSGT','SMMC','WO','2ndLT','1stLT','CPT','MAJ','LTCOL','COL','XO','COMMANDER','BGEN','MAJGEN','LTGEN'];
        const FILES=[
            {name:'USMC Medals',url:'https://docs.google.com/document/d/1XUR7u36HC6_rd0LeR-wdeXSnLtk4AQPyakwAQgZBUCM/edit?usp=sharing'},
            {name:'USMC All In One Form',url:'https://forms.gle/uSiiA6asooVhGnUx7'},
            {name:'Enlisted Folder',url:'https://drive.google.com/drive/folders/1gK5STY4MDZTwnsj7UTYpuCiWu721bZRI'},
            {name:'IFN Military Discord',url:'https://discord.gg/HdwSKYH75D'},
            {name:'US Faction Policies',url:'https://docs.google.com/document/d/1km-zdriQAGfwMmxq6MeYbyWwEO1zFY13FVy_ZsOktJI/edit?tab=t.0'},
            {name:'War Policies',url:'https://docs.google.com/document/d/1PlRXI166pmt4sksfOlhr0KjTxqpm72H9Nr9Zh1zATHg/edit?tab=t.0'},
            {name:'Server Rules',url:'https://forums.icefuse.net/index.php?threads/militaryrp-server-rules.14694/'},
            {name:'Server Roleplay Regulations',url:'https://forums.icefuse.net/index.php?threads/militaryrp-roleplay-regulations.403449/'},
            {name:'Drill Instructor Folder',url:'https://drive.google.com/drive/folders/1ZaR7l-NtBibxVTpgU-s8VIYY801GDlKJ?usp=sharing'},
            {name:'Drill Instructor Handbook',url:'https://docs.google.com/document/d/1aDl2pSQgQ9y0aredOFYIM0IpDi_Sg_D-hMKDMmxjxy0/edit?usp=sharing'},
            {name:'MARSOC Mentor Interest Form',url:'https://docs.google.com/forms/d/e/1FAIpQLScy4I9fdfjHq4nugzJGQzMMgTF1Va73AW_3_wmxouMMPqM0kA/viewform'},
            {name:'MARSOC Interest Form',url:'https://docs.google.com/forms/d/e/1FAIpQLSdrvXBnmF4iWzLOs6FWQr0JLEf9RCRyDxc114-2Fh_JHtB4_A/viewform'},
            {name:'Connecting TS3 to Forums',url:'https://forums.icefuse.net/index.php?threads/how-to-sync-your-teamspeak-identity-to-your-devices.171458/'}
        ];
        const Icon=({d,c})=><svg className={c} xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d={d}/></svg>;
        function App(){
            const[page,setPage]=useState('roster');
            const[cfg,setCfg]=useState(false);
            const[auth,setAuth]=useState(false);
            const[modal,setModal]=useState(false);
            const[user,setU]=useState('');
            const[pass,setP]=useState('');
            const[cu,setCu]=useState(null);
            const[config,setConfig]=useState({baseId:'apppTIfE6NtJusdjj',rosterTableName:'Roster',usersTableName:'Users',apiToken:''});
            const[roster,setRoster]=useState([]);
            const[load,setLoad]=useState(false);
            const[err,setErr]=useState('');
            const[succ,setSucc]=useState('');
            const[edit,setEdit]=useState(null);
            const[form,setForm]=useState({});
            const save=()=>{if(!config.baseId||!config.apiToken){setErr('Fill in Base ID and Token');return;}localStorage.setItem('cfg',JSON.stringify(config));setCfg(true);setErr('');fetch();};
            const loadCfg=()=>{const s=localStorage.getItem('cfg');if(s){setConfig(JSON.parse(s));setCfg(true);return true;}return false;};
            const idx=r=>RANKS.indexOf(r);
            const canP=r=>idx(r)>=idx('WO');
            const canD=r=>idx(r)>=idx('MAJ');
            const canE=r=>idx(r)>=idx('MAJ');
            const login=async()=>{if(!user||!pass){setErr('Enter credentials');return;}setLoad(true);setErr('');try{const r=await fetch(`https://api.airtable.com/v0/${config.baseId}/${encodeURIComponent(config.usersTableName)}?filterByFormula=AND({Username}='${user}',{Password}='${pass}')`,{headers:{'Authorization':`Bearer ${config.apiToken}`}});if(!r.ok)throw new Error('Auth failed');const d=await r.json();if(d.records&&d.records.length>0){const u=d.records[0];setCu({id:u.id,username:u.fields.Username,rank:u.fields.Rank,name:u.fields.Name||u.fields.Username});setAuth(true);setU('');setP('');setModal(false);setSucc('Login success');setTimeout(()=>setSucc(''),3000);}else{setErr('Invalid credentials');}}catch(e){setErr(`Login error: ${e.message}`);}finally{setLoad(false);}};
            const fetch=async()=>{setLoad(true);setErr('');try{const r=await fetch(`https://api.airtable.com/v0/${config.baseId}/${encodeURIComponent(config.rosterTableName)}`,{headers:{'Authorization':`Bearer ${config.apiToken}`}});if(!r.ok)throw new Error(`Failed: ${r.status}`);const d=await r.json();setRoster(d.records||[]);}catch(e){setErr(`Error: ${e.message}`);}finally{setLoad(false);}};
            const req=()=>{if(!auth){setModal(true);setErr('Login required');return false;}return true;};
            const promote=async(id,r,n)=>{if(!req()||!canP(cu.rank)){setErr('No permission');return;}const i=idx(r);if(i===-1||i===RANKS.length-1){setErr(`Can't promote ${n}`);return;}await upd(id,RANKS[i+1],n,'promoted');};
            const demote=async(id,r,n)=>{if(!req()||!canD(cu.rank)){setErr('No permission (MAJ+)');return;}const i=idx(r);if(i===-1||i===0){setErr(`Can't demote ${n}`);return;}await upd(id,RANKS[i-1],n,'demoted');};
            const upd=async(id,r,n,a)=>{setLoad(true);setErr('');setSucc('');try{const res=await fetch(`https://api.airtable.com/v0/${config.baseId}/${encodeURIComponent(config.rosterTableName)}/${id}`,{method:'PATCH',headers:{'Authorization':`Bearer ${config.apiToken}`,'Content-Type':'application/json'},body:JSON.stringify({fields:{'Rank':r}})});if(!res.ok)throw new Error(`Failed: ${res.status}`);setSucc(`âœ“ ${n} ${a} to ${r}`);setTimeout(()=>setSucc(''),3000);await fetch();}catch(e){setErr(`Error: ${e.message}`);}finally{setLoad(false);}};
            const startE=(rec)=>{if(!req()||!canE(cu.rank)){setErr('No permission (MAJ+)');return;}setEdit(rec.id);setForm(rec.fields);};
            const cancelE=()=>{setEdit(null);setForm({});};
            const saveE=async(id)=>{setLoad(true);setErr('');setSucc('');try{const r=await fetch(`https://api.airtable.com/v0/${config.baseId}/${encodeURIComponent(config.rosterTableName)}/${id}`,{method:'PATCH',headers:{'Authorization':`Bearer ${config.apiToken}`,'Content-Type':'application/json'},body:JSON.stringify({fields:form})});if(!r.ok)throw new Error(`Failed: ${r.status}`);setSucc('âœ“ Updated');setTimeout(()=>setSucc(''),3000);setEdit(null);setForm({});await fetch();}catch(e){setErr(`Error: ${e.message}`);}finally{setLoad(false);}};
            useEffect(()=>{const c=loadCfg();if(c)fetch();},[]); 
            if(!cfg)return <div className="min-h-screen bg-slate-900 text-white p-8"><div className="max-w-2xl mx-auto"><div className="bg-slate-800 rounded-lg p-8 shadow-xl border border-slate-700"><h1 className="text-3xl font-bold mb-6 text-center">ğŸ–ï¸ Setup</h1><div className="space-y-4"><div><label className="block text-sm mb-2">Base ID</label><input type="text" value={config.baseId} onChange={e=>setConfig({...config,baseId:e.target.value})} className="w-full px-4 py-2 bg-slate-700 rounded border border-slate-600 text-white"/></div><div><label className="block text-sm mb-2">Roster Table</label><input type="text" value={config.rosterTableName} onChange={e=>setConfig({...config,rosterTableName:e.target.value})} className="w-full px-4 py-2 bg-slate-700 rounded border border-slate-600 text-white"/></div><div><label className="block text-sm mb-2">Users Table</label><input type="text" value={config.usersTableName} onChange={e=>setConfig({...config,usersTableName:e.target.value})} className="w-full px-4 py-2 bg-slate-700 rounded border border-slate-600 text-white"/></div><div><label className="block text-sm mb-2">API Token</label><input type="password" value={config.apiToken} onChange={e=>setConfig({...config,apiToken:e.target.value})} className="w-full px-4 py-2 bg-slate-700 rounded border border-slate-600 text-white"/></div>{err&&<div className="bg-red-900/50 border border-red-700 rounded p-3 text-sm">{err}</div>}<button onClick={save} className="w-full bg-blue-600 hover:bg-blue-700 py-3 rounded">Save</button></div></div></div></div>;
            const uP=auth&&canP(cu.rank);const uD=auth&&canD(cu.rank);const uE=auth&&canE(cu.rank);
            return <div className="min-h-screen bg-slate-900 text-white">{modal&&<div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"><div className="bg-slate-800 rounded-lg p-8 border border-slate-700 w-full max-w-md"><h2 className="text-2xl font-bold mb-6 text-center">Login</h2><div className="space-y-4"><input type="text" placeholder="Username" value={user} onChange={e=>setU(e.target.value)} className="w-full px-4 py-3 bg-slate-700 rounded border border-slate-600 text-white"/><input type="password" placeholder="Password" value={pass} onChange={e=>setP(e.target.value)} onKeyPress={e=>e.key==='Enter'&&login()} className="w-full px-4 py-3 bg-slate-700 rounded border border-slate-600 text-white"/>{err&&<div className="bg-red-900/50 border border-red-700 rounded p-3 text-sm">{err}</div>}<button onClick={login} disabled={load} className="w-full bg-blue-600 hover:bg-blue-700 py-3 rounded disabled:opacity-50">{load?'Logging in...':'Login'}</button><button onClick={()=>{setModal(false);setErr('');setU('');setP('');}} className="w-full text-slate-400 hover:text-white text-sm">Cancel</button></div></div></div>}<div className="bg-slate-800 border-b border-slate-700"><div className="max-w-7xl mx-auto px-4"><div className="flex items-center justify-between"><div className="flex gap-1"><button onClick={()=>setPage('roster')} className={`px-4 py-4 border-b-2 ${page==='roster'?'border-blue-500 text-blue-400':'border-transparent text-slate-400 hover:text-white'}`}>Roster</button><button onClick={()=>setPage('files')} className={`px-4 py-4 border-b-2 ${page==='files'?'border-blue-500 text-blue-400':'border-transparent text-slate-400 hover:text-white'}`}>Files</button></div><div className="flex items-center gap-2 py-2">{auth?<><span className="text-sm text-slate-400 mr-2 hidden sm:inline">{cu.name} ({cu.rank})</span><button onClick={()=>{setAuth(false);setCu(null);setSucc('Logged out');setTimeout(()=>setSucc(''),3000);}} className="flex items-center gap-2 bg-slate-600 hover:bg-slate-700 px-3 py-2 rounded text-sm">Logout</button></>:<button onClick={()=>setModal(true)} className="flex items-center gap-2 bg-green-600 hover:bg-green-700 px-3 py-2 rounded text-sm">Login</button>}</div></div></div></div><div className="p-4 md:p-8">{page==='roster'?<div className="max-w-7xl mx-auto"><div className="bg-slate-800 rounded-lg shadow-xl border border-slate-700"><div className="p-6 border-b border-slate-700 flex justify-between"><h1 className="text-3xl font-bold">ğŸ–ï¸ Roster</h1><button onClick={fetch} disabled={load} className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded disabled:opacity-50">Refresh</button></div>{auth&&<div className="p-6 border-b border-slate-700 bg-slate-750"><div className="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm"><div className="flex items-center gap-2"><span className={uP?'text-green-400':'text-slate-500'}>{uP?'âœ“':'âœ—'}</span><span>Promote (WO+)</span></div><div className="flex items-center gap-2"><span className={uD?'text-green-400':'text-slate-500'}>{uD?'âœ“':'âœ—'}</span><span>Demote (MAJ+)</span></div><div className="flex items-center gap-2"><span className={uE?'text-green-400':'text-slate-500'}>{uE?'âœ“':'âœ—'}</span><span>Edit (MAJ+)</span></div></div></div>}{err&&!modal&&<div className="m-6 bg-red-900/50 border border-red-700 rounded p-4">{err}</div>}{succ&&<div className="m-6 bg-green-900/50 border border-green-700 rounded p-4">{succ}</div>}<div className="p-6">{load&&roster.length===0?<div className="text-center py-12 text-slate-400">Loading...</div>:roster.length===0?<div className="text-center py-12 text-slate-400">No data</div>:<div className="overflow-x-auto"><table className="w-full"><thead><tr className="border-b border-slate-700"><th className="text-left py-3 px-4">Name</th><th className="text-left py-3 px-4">Rank</th><th className="text-left py-3 px-4">SteamID</th><th className="text-left py-3 px-4">Last Promoted</th>{auth&&<th className="text-center py-3 px-4">Actions</th>}</tr></thead><tbody>{roster.map(rec=>{const n=rec.fields.Name||rec.fields.Username||'Unknown';const r=rec.fields.Rank||'N/A';const s=rec.fields.SteamID||'-';const l=rec.fields['Last Promoted']?new Date(rec.fields['Last Promoted']).toLocaleDateString():'-';const i=idx(r);const e=edit===rec.id;return <tr key={rec.id} className="border-b border-slate-700 hover:bg-slate-750"><td className="py-3 px-4">{e?<input type="text" value={form.Name||form.Username||''} onChange={ev=>setForm({...form,Name:ev.target.value})} className="bg-slate-700 px-2 py-1 rounded border border-slate-600 w-full text-white"/>:n}</td><td className="py-3 px-4">{e?<select value={form.Rank} onChange={ev=>setForm({...form,Rank:ev.target.value})} className="bg-slate-700 px-2 py-1 rounded border border-slate-600 text-white">{RANKS.map(rk=><option key={rk} value={rk}>{rk}</option>)}</select>:<span className="bg-blue-900/50 text-blue-300 px-3 py-1 rounded text-sm font-mono">{r}</span>}</td><td className="py-3 px-4 text-slate-300">{e?<input type="text" value={form.SteamID||''} onChange={ev=>setForm({...form,SteamID:ev.target.value})} className="bg-slate-700 px-2 py-1 rounded border border-slate-600 w-full text-white"/>:<span className="font-mono text-sm">{s}</span>}</td><td className="py-3 px-4 text-slate-400 text-sm">{l}</td>{auth&&<td className="py-3 px-4"><div className="flex justify-center gap-2 flex-wrap">{e?<><button onClick={()=>saveE(rec.id)} disabled={load} className="bg-green-600 hover:bg-green-700 px-3 py-1 rounded disabled:opacity-50">Save</button><button onClick={cancelE} className="bg-slate-600 hover:bg-slate-700 px-3 py-1 rounded">Cancel</button></>:<>{uP&&i<RANKS.length-1&&<button onClick={()=>promote(rec.id,r,n)} disabled={load} className="bg-green-600 hover:bg-green-700 px-3 py-1 rounded disabled:opacity-50">Promote</button>}{uD&&i>0&&<button onClick={()=>demote(rec.id,r,n)} disabled={load} className="bg-orange-600 hover:bg-orange-700 px-3 py-1 rounded disabled:opacity-50">Demote</button>}{uE&&<button onClick={()=>startE(rec)} disabled={load} className="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded disabled:opacity-50">Edit</button>}</>}</div></td>}</tr>})}</tbody></table></div>}</div></div></div>:<div className="max-w-5xl mx-auto"><div className="bg-slate-800 rounded-lg shadow-xl border border-slate-700 p-8"><h1 className="text-3xl font-bold mb-6">ğŸ“ File Cabinet</h1><p className="text-slate-400 mb-8">Documents, forms, and resources</p><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">{FILES.map((f,i)=><a key={i} href={f.url} target="_blank" rel="noopener noreferrer" className="bg-slate-700 hover:bg-slate-600 p-4 rounded-lg border border-slate-600 hover:border-blue-500 transition group"><div className="flex justify-between"><h3 className="font-semibold text-white group-hover:text-blue-400">{f.name}</h3><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg></div></a>)}</div></div></div>}</div></div>;}
        const root=ReactDOM.createRoot(document.getElementById('app'));root.render(<App/>);
    </script>
</body>
</html>
